<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tic Tac Toe Neon – Online Fixed</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<style>
/* (CSS sama kayak versi neon lu, ringkas di sini biar fokus fix logic) */
body{margin:0;min-height:100vh;display:flex;justify-content:center;align-items:center;
background:radial-gradient(circle at top,#020024,#090979,#00d4ff);font-family:Arial;color:white}
.game-box{padding:20px;border-radius:18px;background:rgba(0,0,0,.7);box-shadow:0 0 30px cyan;width:390px}
h1{text-align:center;text-shadow:0 0 12px cyan}
.row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
input,select,button{width:100%;padding:8px;border-radius:8px;border:none;margin:4px 0}
button{background:cyan;color:black;font-weight:bold;cursor:pointer}
.board{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:12px 0}
.cell{height:90px;font-size:40px;border:none;border-radius:12px;background:#020024;color:cyan;box-shadow:inset 0 0 12px cyan,0 0 10px cyan}
.hidden{display:none}
.status{text-align:center;font-weight:bold}
</style>
</head>
<body>

<div class="game-box">
<h1>⚡ TIC TAC TOE ⚡</h1>

<select id="mode">
  <option value="pvp">Player vs Player</option>
  <option value="bot">Player vs Bot</option>
  <option value="online">Online Firebase</option>
</select>

<div class="row" id="nameRow">
  <input id="nameX" placeholder="Nama kamu (Online)">
  <input id="nameO" placeholder="Nama Player B (PVP)">
</div>

<div class="row hidden" id="onlineBox">
  <button id="btnCreate">Create Room</button>
  <input id="roomCode" placeholder="Room Code">
  <button id="btnJoin">Join</button>
</div>

<div class="status" id="status">Isi nama → Create / Join</div>
<div class="board" id="board"></div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB6gh_UggmwJDcPJ_ZL_JThDC5PPtgLLVA",
  authDomain: "tictaetoe-c1e7f.firebaseapp.com",
  projectId: "tictaetoe-c1e7f",
  databaseURL: "https://tictaetoe-c1e7f-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");
const modeEl = document.getElementById("mode");
const onlineBox = document.getElementById("onlineBox");
const nameX = document.getElementById("nameX");
const nameO = document.getElementById("nameO");
const btnCreate = document.getElementById("btnCreate");
const btnJoin = document.getElementById("btnJoin");
const roomCodeInput = document.getElementById("roomCode");

let board = ["","","","","","","","",""];
let turn = "X";
let gameActive = true;
let roomId = null;
let online = false;
let mySide = "X"; // X = host, O = joiner

const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

for(let i=0;i<9;i++){
  const b=document.createElement("button");
  b.className="cell";
  b.onclick=()=>play(i);
  boardEl.appendChild(b);
}

modeEl.onchange = () => {
  online = modeEl.value === "online";
  onlineBox.classList.toggle("hidden", !online);
  nameO.classList.toggle("hidden", modeEl.value !== "pvp");
  statusEl.textContent = online ? "Isi nama → Create / Join" : "Giliran: X";
};

btnCreate.onclick = () => {
  if(!nameX.value) return alert("Isi nama kamu dulu!");
  roomId = "ROOM" + Math.floor(Math.random()*9999);
  mySide = "X";
  db.ref("rooms/"+roomId).set({
    board, turn,
    hostName: nameX.value,
    joinName: ""
  });
  statusEl.textContent = "Room: " + roomId + " | Menunggu lawan...";
  listenRoom();
  alert("Room Code: " + roomId);
};

btnJoin.onclick = () => {
  if(!nameX.value) return alert("Isi nama kamu dulu!");
  const code = roomCodeInput.value.trim();
  if(!code) return alert("Masukin Room Code!");
  roomId = code;
  mySide = "O";
  db.ref("rooms/"+roomId).once("value").then(snap=>{
    if(!snap.exists()) return alert("Room tidak ditemukan!");
    db.ref("rooms/"+roomId).update({ joinName: nameX.value });
    listenRoom();
  });
};

function play(i){
  if(!online || !gameActive) return;
  if(turn !== mySide) return;       // bukan giliran lu
  if(board[i]) return;

  board[i] = mySide;
  syncRoom();
}

function listenRoom(){
  db.ref("rooms/"+roomId).on("value", snap=>{
    if(!snap.val()) return;
    const data = snap.val();
    board = data.board;
    turn = data.turn;
    render();

    const lawan = mySide === "X" ? data.joinName : data.hostName;
    statusEl.textContent = `Room: ${roomId} | Kamu: ${nameX.value} vs ${lawan || "Menunggu..." } | Giliran: ${turn}`;
  });
}

function syncRoom(){
  const next = turn === "X" ? "O" : "X";
  db.ref("rooms/"+roomId).update({ board, turn: next });
}

function render(){
  document.querySelectorAll(".cell").forEach((c,i)=>c.textContent=board[i]);
}
</script>
</body>
</html>
