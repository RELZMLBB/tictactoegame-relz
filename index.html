<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe Neon ‚Äì Relz</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<style>
@keyframes rgb {0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}
@keyframes glow {0%{text-shadow:0 0 6px cyan}50%{text-shadow:0 0 18px cyan}100%{text-shadow:0 0 6px cyan}}
@keyframes creditGlow {0%{text-shadow:0 0 6px #00fff7}50%{text-shadow:0 0 24px #00fff7}100%{text-shadow:0 0 6px #00fff7}}
body{margin:0;min-height:100vh;display:flex;justify-content:center;align-items:center;background:radial-gradient(circle at top,#020024,#090979,#00d4ff);font-family:Arial;color:white}
.game-box{padding:18px;border-radius:18px;background:rgba(0,0,0,.7);box-shadow:0 0 30px cyan;animation:rgb 6s linear infinite;width:390px}
h1{text-align:center;animation:glow 2s infinite}
.row{display:flex;gap:8px}
input,select,button{padding:8px;border-radius:8px;border:none;margin:4px 0;width:100%}
.row input{width:50%;box-sizing:border-box}
button{background:cyan;color:black;font-weight:bold;cursor:pointer;box-shadow:0 0 10px cyan}
.board{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:12px 0}
.cell{height:90px;font-size:40px;border:none;border-radius:12px;background:#020024;color:cyan;box-shadow:inset 0 0 12px cyan,0 0 10px cyan;cursor:pointer}
.cell.win{background:cyan;color:black;box-shadow:0 0 25px cyan}
.status,.score{text-align:center;font-weight:bold;text-shadow:0 0 8px cyan}
.hidden{display:none}
.leader{font-size:12px;margin-top:6px}
.credit{text-align:center;margin-top:8px;color:#00fff7;animation:creditGlow 2.5s infinite}
</style>
</head>
<body>

<div class="game-box">
  <h1>‚ö° TIC TAC TOE ‚ö°</h1>

  <div class="row">
    <select id="mode">
      <option value="pvp">Player vs Player</option>
      <option value="bot">Player vs Bot</option>
      <option value="online">Online Firebase</option>
    </select>
    <select id="boMode">
      <option value="1">BO 1</option>
      <option value="3">BO 3</option>
      <option value="5">BO 5</option>
      <option value="7">BO 7</option>
    </select>
  </div>

  <div class="row" id="namesPVP">
    <input id="nameX" placeholder="Nama Player A">
    <input id="nameO" placeholder="Nama Player B">
  </div>

  <div class="row hidden" id="nameOnlineRow">
    <input id="nameOnline" placeholder="Nama Kamu (wajib sebelum Create/Join)">
  </div>

  <div class="row hidden" id="onlineBox">
    <button id="btnCreate">Create Room</button>
    <input id="roomCode" placeholder="Kode 4 Digit">
    <button id="btnJoin">Join</button>
  </div>

  <div class="score" id="scoreText">Score: 0 - 0</div>
  <div class="status" id="status">Pilih mode & isi nama</div>
  <div class="board" id="board"></div>

  <div class="leader" id="leaderGlobal"></div>
  <div class="credit">‚ú® Made In Relz ‚ú®</div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB6gh_UggmwJDcPJ_ZL_JThDC5PPtgLLVA",
  authDomain: "tictaetoe-c1e7f.firebaseapp.com",
  projectId: "tictaetoe-c1e7f",
  databaseURL: "https://tictaetoe-c1e7f-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const boardEl = document.getElementById("board");
const statusEl = document.getElementById("status");
const scoreText = document.getElementById("scoreText");
const modeEl = document.getElementById("mode");
const boModeEl = document.getElementById("boMode");
const onlineBox = document.getElementById("onlineBox");
const namesPVP = document.getElementById("namesPVP");
const nameOnlineRow = document.getElementById("nameOnlineRow");
const leaderGlobal = document.getElementById("leaderGlobal");

let board=["","","","","","","","",""];
let turn="X",gameActive=true,roomId=null,isOnline=false,mySymbol=null,myName="";
let scoreX=0, scoreO=0, starter="X";

const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

for(let i=0;i<9;i++){
  const b=document.createElement("button");
  b.className="cell";
  b.onclick=()=>play(i);
  boardEl.appendChild(b);
}

modeEl.onchange=()=>{
  const online = modeEl.value==="online";
  onlineBox.classList.toggle("hidden", !online);
  nameOnlineRow.classList.toggle("hidden", !online);
  namesPVP.classList.toggle("hidden", online);
  boModeEl.classList.toggle("hidden", online); // ONLINE TANPA BO
  isOnline = online;
  statusEl.textContent = online ? "Isi nama dulu, lalu Create / Join" : "Siap main!";
};

function render(){document.querySelectorAll(".cell").forEach((c,i)=>c.textContent=board[i]);}
function updateScore(){scoreText.textContent = `Score: ${scoreX} - ${scoreO}`;}

function resetRound(){
  board=["","","","","","","","",""];
  turn = starter;
  starter = starter==="X"?"O":"X";
  gameActive=true;
  document.querySelectorAll(".cell").forEach(c=>c.classList.remove("win"));
  render();
  statusEl.textContent = "Ronde baru! Giliran: " + turn;
  if(isOnline) syncRoom();
}

function checkWin(){
  for(let p of wins){
    if(p.every(i=>board[i]===turn)){
      p.forEach(i=>document.querySelectorAll(".cell")[i].classList.add("win"));
      return true;
    }
  }
  return false;
}

function getName(p){
  if(modeEl.value==="pvp") return p==="X" ? (nameX.value||"Player A") : (nameO.value||"Player B");
  if(modeEl.value==="bot") return p==="X" ? (nameX.value||"Kamu") : "Bot";
  return p===mySymbol ? myName : "Lawan";
}

// BOT SUPER JAGO (MINIMAX)
function minimax(b, isMax){
  if(wins.some(p=>p.every(i=>b[i]==="O"))) return 1;
  if(wins.some(p=>p.every(i=>b[i]==="X"))) return -1;
  if(!b.includes("")) return 0;
  let best = isMax ? -Infinity : Infinity;
  b.forEach((v,i)=>{
    if(v===""){
      b[i]=isMax?"O":"X";
      let score=minimax(b,!isMax);
      b[i]="";
      best = isMax ? Math.max(best,score) : Math.min(best,score);
    }
  });
  return best;
}
function botMove(){
  let best=-Infinity,move=null;
  board.forEach((v,i)=>{
    if(v===""){
      board[i]="O";
      let score=minimax(board,false);
      board[i]="";
      if(score>best){best=score;move=i;}
    }
  });
  setTimeout(()=>play(move),300);
}

function checkBO(){
  const target = Math.ceil(boModeEl.value/2);
  if(scoreX>=target || scoreO>=target){
    statusEl.textContent = "üèÜ JUARA: " + (scoreX>scoreO?getName("X"):getName("O"));
    saveGlobalWin(scoreX>scoreO?getName("X"):getName("O"));
    gameActive=false;
  }
}

function play(i){
  if(!gameActive || board[i]) return;
  if(isOnline && turn!==mySymbol) return;

  board[i]=turn;
  render();

  if(checkWin()){
    statusEl.textContent = "üî• MENANG: " + getName(turn);
    if(turn==="X") scoreX++; else scoreO++;
    updateScore();
    gameActive=false;
    if(!isOnline) checkBO();
    if(isOnline) saveGlobalWin(getName(turn));
    if(isOnline) syncRoom();
    return;
  }
  if(!board.includes("")){
    statusEl.textContent="ü§ù SERI!";
    gameActive=false;
    if(isOnline) syncRoom();
    return;
  }

  turn = turn==="X"?"O":"X";
  statusEl.textContent = "Giliran: " + getName(turn);

  if(modeEl.value==="bot" && turn==="O") botMove();
  if(isOnline) syncRoom();
}

// ===== ONLINE FIREBASE =====
document.getElementById("btnCreate").onclick = () => {
  myName = document.getElementById("nameOnline").value.trim();
  if(!myName) return alert("Isi nama dulu!");
  roomId = String(Math.floor(1000 + Math.random()*9000));
  mySymbol = "X";
  db.ref("rooms/"+roomId).set({ board, turn, X: myName, O: "" });
  listenRoom();
  alert("Room Code: " + roomId);
};

document.getElementById("btnJoin").onclick = () => {
  myName = document.getElementById("nameOnline").value.trim();
  roomId = document.getElementById("roomCode").value.trim();
  if(!myName || !roomId) return alert("Isi nama & kode room!");
  db.ref("rooms/"+roomId).get().then(s=>{
    if(!s.exists()) return alert("Room tidak ditemukan!");
    mySymbol = "O";
    db.ref("rooms/"+roomId+"/O").set(myName);
    listenRoom();
  });
};

function syncRoom(){
  if(!roomId) return;
  db.ref("rooms/"+roomId).update({ board, turn });
}

function listenRoom(){
  db.ref("rooms/"+roomId).on("value", snap=>{
    const v = snap.val();
    if(!v) return;
    board = v.board || board;
    turn = v.turn || turn;
    render();
    const lawan = mySymbol==="X" ? (v.O||"Menunggu lawan...") : (v.X||"Menunggu lawan...");
    statusEl.textContent = `Room ${roomId} | Kamu: ${myName} | Lawan: ${lawan} | Giliran: ${turn}`;
  });
}

// ===== LEADERBOARD GLOBAL TOP 10 =====
function saveGlobalWin(name){
  if(!name) return;
  const ref = db.ref("leaderboard/"+name);
  ref.get().then(s=>{
    const v = s.val() || 0;
    ref.set(v+1);
  });
}
function renderGlobalLB(){
  db.ref("leaderboard").orderByValue().limitToLast(10).on("value", snap=>{
    const data = snap.val() || {};
    const arr = Object.entries(data).sort((a,b)=>b[1]-a[1]);
    leaderGlobal.innerHTML = "üèÜ Global Top 10:<br>" +
      arr.map((e,i)=>`${i+1}. ${e[0]} ‚Äî ${e[1]} win`).join("<br>");
  });
}
renderGlobalLB();
updateScore();
</script>
</body>
</html>
